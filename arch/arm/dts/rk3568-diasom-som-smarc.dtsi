/* SPDX-License-Identifier: GPL-2.0+ */
/* SPDX-FileCopyrightText: Alexander Shiyan <shc_work@mail.ru> */

/dts-v1/;

#include "rk3568-diasom-som.dtsi"

/ {
	model = "Diasom DS-RK3568-SMARC";
	compatible = "diasom,ds-rk3568-som-smarc",
		     "diasom,ds-rk3568-som",
		     "rockchip,rk3568";

	aliases {
		can0 = &can0;
		can1 = &can2;
		ethernet0 = &gmac0;
		ethernet1 = &gmac1;
		i2c6 = &i2c6;
		i2c7 = &i2c7;
		i2c8 = &i2c8;
		i2c9 = &i2c9;
	};

	pcie30_refclk: pcie30-refclk-clock {
		pinctrl-names = "default";
		pinctrl-0 = <&pcie30_clk_pins>;
		compatible = "gated-fixed-clock";
		clock-frequency = <100000000>;
		clock-output-names = "pcie30_refclk";
		enable-gpios = <&gpio1 RK_PB0 GPIO_ACTIVE_HIGH>;
		#clock-cells = <0>;
	};

	pps {
		pinctrl-names = "default";
		pinctrl-0 = <&pps_pins>;
		compatible = "pps-gpio";
		gpios = <&gpio0 RK_PB6 GPIO_ACTIVE_HIGH>;
	};

	vcc2v5_sys: vcc2v5-sys-regulator {
		compatible = "regulator-fixed";
		regulator-name = "2v5_sys";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <2500000>;
		regulator-max-microvolt = <2500000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc_pcie30: vcc-pcie30-regulator {
		pinctrl-names = "default";
		pinctrl-0 = <&pcie30_vcc_pins>;
		compatible = "regulator-fixed";
		gpio = <&gpio2 RK_PD0 GPIO_ACTIVE_LOW>;
		regulator-name = "vcc_pcie30";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		startup-delay-us = <20000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc_sdmmc0: vcc-sdmmc0-regulator {
		pinctrl-names = "default";
		pinctrl-0 = <&sdmmc0_vcc_pins>;
		compatible = "regulator-fixed";
		gpio = <&gpio0 RK_PC1 GPIO_ACTIVE_LOW>;
		regulator-name = "vcc_sdmmc0";
		regulator-boot-on;
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc_usb_host0: vcc-usb-host0-regulator {
		pinctrl-names = "default";
		pinctrl-0 = <&usb_host0_vcc_pins>;
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio0 RK_PC2 GPIO_ACTIVE_HIGH>;
		regulator-name = "vcc_usb_host0";
		regulator-boot-on;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		vin-supply = <&vcc5v0_sys>;
	};
};

&can0 {
	/* CAN0 */
};

&can2 {
	/* CAN1 */
	pinctrl-0 = <&can2m1_pins>;
};

&combphy0 {
	/* SATA0 */
};

&combphy1 {
	/* USB3.0 HOST1 */
	status = "okay";
};

&combphy2 {
	/* PCI-E 2.0 */
	phy-supply = <&vcc3v3_sys>;
	status = "okay";
};

&display_subsystem {
	status = "okay";
};

&i2c2 {
	pinctrl-0 = <&i2c2m1_xfer>;
	clock-frequency = <400000>;
	status = "okay";

	exp: gpio@23 {
		pinctrl-names = "default";
		pinctrl-0 = <&exp_pins>;
		compatible = "nxp,pcal6524";
		reg = <0x23>;
		gpio-controller;
		#gpio-cells = <2>;
		interrupt-controller;
		#interrupt-cells = <2>;
		interrupt-parent = <&gpio2>;
		interrupts = <RK_PD1 IRQ_TYPE_LEVEL_LOW>;
	};

	i2c-mux@70 {
		compatible = "nxp,pca9546";
		reg = <0x70>;
		i2c-mux-idle-disconnect;
		vdd-supply = <&vcc2v5_sys>;
		#address-cells = <1>;
		#size-cells = <0>;

		i2c6: i2c@0 {
			/* I2C_CAM0 */
			reg = <0>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		i2c7: i2c@1 {
			/* I2C_CAM1 */
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		i2c8: i2c@2 {
			/* I2C_LCD */
			reg = <2>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		i2c9: i2c@3 {
			reg = <3>;
			#address-cells = <1>;
			#size-cells = <0>;
		};
	};
};

&i2c3 {
	/* I2C_GP */
	clock-frequency = <400000>;
	status = "okay";

	/* 24aa025e48 */
	eeprom@50 {
		compatible = "atmel,24c02";
		reg = <0x50>;
		pagesize = <16>;
		vcc-supply = <&vcc3v3_sys>;

		nvmem-layout {
			compatible = "fixed-layout";
			#address-cells = <1>;
			#size-cells = <1>;

			mac0: mac-address@fa {
				reg = <0xfa 0x06>;
				read-only;
			};
		};
	};

	/* 24aa025e48 */
	eeprom@51 {
		compatible = "atmel,24c02";
		reg = <0x51>;
		pagesize = <16>;
		vcc-supply = <&vcc3v3_sys>;

		nvmem-layout {
			compatible = "fixed-layout";
			#address-cells = <1>;
			#size-cells = <1>;

			mac1: mac-address@fa {
				reg = <0xfa 0x06>;
				read-only;
			};
		};
	};

	/* m41t62lc6f */
	rtc@68 {
		pinctrl-names = "default";
		pinctrl-0 = <&rtc_pins>;
		compatible = "st,m41t62";
		reg = <0x68>;
		interrupt-parent = <&gpio4>;
		interrupts = <RK_PC4 IRQ_TYPE_LEVEL_LOW>;
		wakeup-source;

		clock {
			compatible = "fixed-clock";
			clock-accuracy = <2000>;
			clock-frequency = <1>;
			clock-output-names = "pps";
			#clock-cells = <0>;
		};
	};
};

&i2c4 {
	/* I2C_PM */
	status = "okay";
};

&gmac0 {
	assigned-clocks = <&cru SCLK_GMAC0_RX_TX>, <&cru SCLK_GMAC0>;
	assigned-clock-parents = <&cru SCLK_GMAC0_RGMII_SPEED>;
	assigned-clock-rates = <0>, <125000000>;
	pinctrl-names = "default";
	pinctrl-0 = <
		&gmac0_tx_bus2 &gmac0_rx_bus2
		&gmac0_rgmii_clk &gmac0_rgmii_bus
	>;
	clock_in_out = "output";
	phy-handle = <&rgmii_phy0>;
	phy-mode = "rgmii-id";
	phy-supply = <&vcc3v3_sys>;
	nvmem-cells = <&mac0>;
	nvmem-cell-names = "mac-address";
	status = "okay";
};

&gmac1 {
	assigned-clocks = <&cru SCLK_GMAC1_RX_TX>, <&cru SCLK_GMAC1>;
	assigned-clock-parents = <&cru SCLK_GMAC1_RGMII_SPEED>;
	assigned-clock-rates = <0>, <125000000>;
	pinctrl-names = "default";
	pinctrl-0 = <
		&gmac1m1_tx_bus2 &gmac1m1_rx_bus2
		&gmac1m1_rgmii_clk &gmac1m1_rgmii_bus
		&gmac1m1_miim
	>;
	clock_in_out = "output";
	phy-handle = <&rgmii_phy1>;
	phy-mode = "rgmii-id";
	phy-supply = <&vcc3v3_sys>;
	nvmem-cells = <&mac1>;
	nvmem-cell-names = "mac-address";
	status = "okay";
};

&gpu {
	status = "okay";
};

&mdio0 {
	status = "disabled";
};

&mdio1 {
	rgmii_phy0: phy@2 {
		/* RTL8211F */
		pinctrl-names = "default";
		pinctrl-0 = <&gmac0_rst_pins>;
		compatible = "ethernet-phy-id001c.c916";
		reg = <0x2>;
		reset-assert-us = <20000>;
		reset-deassert-us = <100000>;
		reset-gpios = <&gpio0 RK_PC5 GPIO_ACTIVE_LOW>;
	};

	rgmii_phy1: phy@4 {
		/* RTL8211F */
		pinctrl-names = "default";
		pinctrl-0 = <&gmac1_rst_pins>;
		compatible = "ethernet-phy-id001c.c916";
		reg = <0x4>;
		reset-assert-us = <20000>;
		reset-deassert-us = <100000>;
		reset-gpios = <&gpio0 RK_PA0 GPIO_ACTIVE_LOW>;
	};
};

&pcie2x1 {
	/* PCIE_C */
	pinctrl-names = "default";
	pinctrl-0 = <&pcie2x1_pins>;
	reset-gpios = <&gpio3 RK_PC1 GPIO_ACTIVE_HIGH>;
	vpcie3v3-supply = <&vcc3v3_sys>;
};

//&pcie30phy {
//	phy-supply = <&vcc_pcie30>;
//	status = "okay";
//};

//pcie30_refclk should be handles in pci node

&pwm4 {
	/* LCD0_BKLT_PWM */
};

&pwm5 {
	/* LCD1_BKLT_PWM */
};

&rga {
	status = "okay";
};

&sata0 {
	status = "okay";
};

&sdmmc0 {
	pinctrl-names = "default";
	pinctrl-0 = <
		&sdmmc0_bus4 &sdmmc0_clk &sdmmc0_cmd
		&sdmmc0_det &sdmmc0_wp
	>;
	bus-width = <4>;
	cap-mmc-highspeed;
	cap-sd-highspeed;
	cd-gpios = <&gpio0 RK_PA4 GPIO_ACTIVE_LOW>;
	wp-gpios = <&gpio4 RK_PD2 GPIO_ACTIVE_LOW>;
	sd-uhs-sdr104;
	vmmc-supply = <&vcc_sdmmc0>;
	vqmmc-supply = <&vccio_sd>;
};

&spi2 {
	/* SMARC SPI0 */
	num-cs = <2>;
};

&spi3 {
	/* SMARC SPI1 */
	pinctrl-0 = <&spi3m1_cs0 &spi3m1_cs1 &spi3m1_pins>;
	num-cs = <2>;
};

&uart2 {
	/* SMARC SER1 */
};

&uart4 {
	/* SMARC SER0 */
	pinctrl-0 = <&uart4m0_xfer &uart4m0_ctsn &uart4m0_rtsn>;
};

&uart5 {
	/* SMARC SER3 */
	pinctrl-0 = <&uart5m1_xfer>;
};

&uart8 {
	/* SMARC SER2 */
	pinctrl-0 = <&uart8m1_xfer>;
};

&usb_host0_xhci {
	/* USB0 */
	phys = <&usb2phy0_otg>;
	phy-names = "usb2-phy";
	maximum-speed = "high-speed";
	dr_mode = "host";
	vbus-supply = <&vcc_usb_host0>;
};

&usb_host1_ehci {
	status = "okay";
};

&usb_host1_ohci {
	status = "okay";
};

&usb_host1_xhci {
	status = "okay";
};

&usb2phy0_host {
	status = "okay";
};

&usb2phy1_host {
	status = "okay";
};

&vpu {
	status = "okay";
};

&vdpu_mmu {
	status = "okay";
};

&vepu {
	status = "okay";
};

&vepu_mmu {
	status = "okay";
};

&pinctrl {
	exp {
		exp_pins: exp-pins {
			rockchip,pins =
				<2 RK_PD1 RK_FUNC_GPIO &pcfg_pull_none>;	/* GPIO_EXP_INT */
		};
	};

	mmc {

		sdmmc0_vcc_pins: sdmmc0-vcc--pins {
			rockchip,pins =
				<0 RK_PC1 RK_FUNC_GPIO &pcfg_pull_none>;	/* SDMMC0_PWR_EN */
		};

		sdmmc0_wp: sdmmc0-wp-pins {
			rockchip,pins =
				<4 RK_PD2 RK_FUNC_GPIO &pcfg_pull_up>;		/* SDMMC0_WP */
		};
	};

	net {
		gmac0_rst_pins: gmac0-rst-pins {
			rockchip,pins =
				<0 RK_PC5 RK_FUNC_GPIO &pcfg_pull_none>;	/* GMAC0_RST */
		};

		gmac1_rst_pins: gmac1-rst-pins {
			rockchip,pins =
				<0 RK_PA0 RK_FUNC_GPIO &pcfg_pull_none>;	/* GMAC1_RST */
		};
	};

	pci {
		pcie2x1_pins: pcie2x1-pins {
			rockchip,pins =
				<3 RK_PC1 RK_FUNC_GPIO &pcfg_pull_none>,	/* PCIE_C_RST# */
				<1 RK_PB1 4 &pcfg_pull_none>;			/* pcie20_wakenm2 */
		};

		pcie30_clk_pins: pcie30-clk-pins {
			rockchip,pins =
				<1 RK_PB0 RK_FUNC_GPIO &pcfg_pull_none>;	/* PCIE30_CLK_IC_OE */
		};

		pcie30_vcc_pins: pcie30-vcc-pins {
			rockchip,pins =
				<2 RK_PD0 RK_FUNC_GPIO &pcfg_pull_none>;	/* PCIE30_CLK_IC_PDN */
		};
	};

	pps {
		pps_pins: pps-pins {
			rockchip,pins =
				<0 RK_PB6 RK_FUNC_GPIO &pcfg_pull_none>;	/* RTC_SQW */
		};
	};

	rtc {
		rtc_pins: rtc-pins {
			rockchip,pins =
				<4 RK_PC4 RK_FUNC_GPIO &pcfg_pull_none>;	/* RTC_IRQ */
		};
	};

	usb {
		usb_host0_vcc_pins: usb-host0-vcc-pins {
			rockchip,pins =
				<0 RK_PC2 RK_FUNC_GPIO &pcfg_pull_none>;	/* USB_OTG_EN_OC# */
		};
	};
};
