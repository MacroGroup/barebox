/* SPDX-License-Identifier: GPL-2.0+ */
/* SPDX-FileCopyrightText: Alexander Shiyan <shc_work@mail.ru> */

/dts-v1/;

#include "rk3568-diasom-som.dtsi"

/ {
	model = "Diasom DS-RK3568-SMARC";
	compatible = "diasom,ds-rk3568-som-smarc",
		     "diasom,ds-rk3568-som",
		     "rockchip,rk3568";

	aliases {
		can0 = &can0;
		can1 = &can2;
		ethernet0 = &gmac0;
		ethernet1 = &gmac1;
		i2c6 = &i2c6;
		i2c7 = &i2c7;
		i2c8 = &i2c8;
		i2c9 = &i2c9;
	};

	gpio-keys {
		compatible = "gpio-keys";

		lid {
			label = "LID";
			linux,code = <SW_LID>;
			linux,input-type = <EV_SW>;
			gpios = <&exp 7 GPIO_ACTIVE_LOW>;
		};

		sleep {
			label = "SLEEP";
			linux,code = <KEY_SLEEP>;
			linux,input-type = <EV_KEY>;
			gpios = <&exp 8 GPIO_ACTIVE_LOW>;
		};
	};

	pps {
		pinctrl-names = "default";
		pinctrl-0 = <&pps_pins>;
		compatible = "pps-gpio";
		gpios = <&gpio0 RK_PB6 GPIO_ACTIVE_HIGH>;
	};

	vcc2v5_sys: vcc2v5-sys-regulator {
		compatible = "regulator-fixed";
		regulator-name = "2v5_sys";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <2500000>;
		regulator-max-microvolt = <2500000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc3v3_pcie30_clk_oe: vcc3v3-pcie30-clk-oe-regulator {
		pinctrl-names = "default";
		pinctrl-0 = <&pcie30_clk_oe_pins>;
		compatible = "regulator-fixed";
		gpio = <&gpio1 RK_PB0 GPIO_ACTIVE_LOW>;
		regulator-name = "vcc3v3_pcie30_clk_oe";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		startup-delay-us = <20000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc3v3_pcie30_clk_run: vcc3v3-pcie30-clk-run-regulator {
		pinctrl-names = "default";
		pinctrl-0 = <&pcie30_clk_run_pins>;
		compatible = "regulator-fixed";
		gpio = <&gpio2 RK_PD0 GPIO_ACTIVE_LOW>;
		regulator-name = "vcc3v3_pcie30_clk_run";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		startup-delay-us = <20000>;
		vin-supply = <&vcc3v3_pcie30_clk_oe>;
	};

	vcc_sdmmc0: vcc-sdmmc0-regulator {
		pinctrl-names = "default";
		pinctrl-0 = <&sdmmc0_vcc_pins>;
		compatible = "regulator-fixed";
		gpio = <&gpio0 RK_PC1 GPIO_ACTIVE_LOW>;
		regulator-name = "vcc_sdmmc0";
		regulator-boot-on;
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vcc3v3_sys>;
	};

	vcc_usb_host0: vcc-usb-host0-regulator {
		pinctrl-names = "default";
		pinctrl-0 = <&usb_host0_vcc_pins>;
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio0 RK_PC2 GPIO_ACTIVE_HIGH>;
		regulator-name = "vcc_usb_host0";
		regulator-boot-on;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		vin-supply = <&vcc5v0_sys>;
	};
};

&can0 {
	/* CAN0 */
};

&can2 {
	/* CAN1 */
	pinctrl-0 = <&can2m1_pins>;
};

&combphy0 {
	/* SATA0 */
};

&combphy1 {
	/* USB3.0 HOST1 */
	status = "okay";
};

&combphy2 {
	/* PCI-E 2.0 */
	phy-supply = <&vcc3v3_sys>;
	status = "okay";
};

&i2c2 {
	pinctrl-0 = <&i2c2m1_xfer>;
	clock-frequency = <400000>;
	status = "okay";

	exp: gpio@23 {
		/* DD23 */
		pinctrl-names = "default";
		pinctrl-0 = <&exp_pins>;
		compatible = "nxp,pcal6524";
		reg = <0x23>;
		gpio-controller;
		#gpio-cells = <2>;
		interrupt-controller;
		#interrupt-cells = <2>;
		interrupt-parent = <&gpio2>;
		interrupts = <RK_PD1 IRQ_TYPE_LEVEL_LOW>;

		gpio-line-names =
			/* P0_0-7 */
			"GPIO8", "GPIO9", "GPIO10", "GPIO11",
			"GPIO12", "GPIO13", "WDT_TIME_OUT#", "LID#",
			/* P1_0-7 */
			"SLEEP#", "CHARGE#", "CHARGER_PRSNT#", "CARRIER_STBY#",
			"BATLOW#", "TEST#", "LCD0_VDD_EN", "",
			/* P2_0-7 */
			"", "", "", "",
			"", "", "", "";
	};

	i2c-mux@70 {
		/* DD24 */
		compatible = "nxp,pca9546";
		reg = <0x70>;
		i2c-mux-idle-disconnect;
		vdd-supply = <&vcc2v5_sys>;
		#address-cells = <1>;
		#size-cells = <0>;

		i2c6: i2c@0 {
			/* I2C_CAM0 */
			reg = <0>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		i2c7: i2c@1 {
			/* I2C_CAM1 */
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		i2c8: i2c@2 {
			/* I2C_LCD */
			reg = <2>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		i2c9: i2c@3 {
			reg = <3>;
			#address-cells = <1>;
			#size-cells = <0>;
		};
	};
};

&i2c3 {
	/* I2C_GP */
	clock-frequency = <400000>;
	status = "okay";

	/* 24aa025e48 */
	eeprom@50 {
		compatible = "atmel,24c02";
		reg = <0x50>;
		pagesize = <16>;
		vcc-supply = <&vcc3v3_sys>;

		nvmem-layout {
			compatible = "fixed-layout";
			#address-cells = <1>;
			#size-cells = <1>;

			mac0: mac-address@fa {
				reg = <0xfa 0x06>;
				read-only;
			};
		};
	};

	/* 24aa025e48 */
	eeprom@51 {
		compatible = "atmel,24c02";
		reg = <0x51>;
		pagesize = <16>;
		vcc-supply = <&vcc3v3_sys>;

		nvmem-layout {
			compatible = "fixed-layout";
			#address-cells = <1>;
			#size-cells = <1>;

			mac1: mac-address@fa {
				reg = <0xfa 0x06>;
				read-only;
			};
		};
	};

	/* m41t62lc6f */
	rtc: rtc@68 {
		pinctrl-names = "default";
		pinctrl-0 = <&rtc_pins>;
		compatible = "st,m41t62";
		reg = <0x68>;
		interrupt-parent = <&gpio4>;
		interrupts = <RK_PC4 IRQ_TYPE_LEVEL_LOW>;
		wakeup-source;
		#clock-cells = <0>;
	};
};

&i2c4 {
	/* I2C_PM */
	status = "okay";
};

&i2s1_8ch {
	/* I2S0 */
	pinctrl-0 = <
		&i2s1m1_mclk &i2s1m1_sclktx
		&i2s1m1_lrcktx &i2s1m1_sdo0
		&i2s1m1_sdi0
	>;
	rockchip,trcm-sync-tx-only;
};

&gmac0 {
	/* GBE0 */
	assigned-clocks = <&cru SCLK_GMAC0_RX_TX>, <&cru SCLK_GMAC0>;
	assigned-clock-parents = <&cru SCLK_GMAC0_RGMII_SPEED>;
	assigned-clock-rates = <0>, <125000000>;
	pinctrl-names = "default";
	pinctrl-0 = <
		&gmac0_tx_bus2 &gmac0_rx_bus2
		&gmac0_rgmii_clk &gmac0_rgmii_bus
	>;
	clock_in_out = "output";
	phy-handle = <&rgmii_phy0>;
	phy-mode = "rgmii-id";
	phy-supply = <&vcc3v3_sys>;
	nvmem-cells = <&mac0>;
	nvmem-cell-names = "mac-address";
	status = "okay";
};

&gmac1 {
	/* GBE1 */
	assigned-clocks = <&cru SCLK_GMAC1_RX_TX>, <&cru SCLK_GMAC1>;
	assigned-clock-parents = <&cru SCLK_GMAC1_RGMII_SPEED>;
	assigned-clock-rates = <0>, <125000000>;
	pinctrl-names = "default";
	pinctrl-0 = <
		&gmac1m1_tx_bus2 &gmac1m1_rx_bus2
		&gmac1m1_rgmii_clk &gmac1m1_rgmii_bus
	>;
	clock_in_out = "output";
	phy-handle = <&rgmii_phy1>;
	phy-mode = "rgmii-id";
	phy-supply = <&vcc3v3_sys>;
	nvmem-cells = <&mac1>;
	nvmem-cell-names = "mac-address";
	status = "okay";
};

&gpio0 {
	gpio-line-names =
		/* GPIO0 A0-A7 */
		"GMAC1_PHY_RESET#", "TCADC_SHUT_M0", "PMIC_SLEEP", "PMIC_IRQ#",
		"SDMMC0_DET#", "TEST1", "LED1", "FLASH_V_SELECT",
		/* GPIO0 B0-B7 */
		"CLK_32K_IN", "I2C0_SCL", "I2C0_SDA", "CAN0_TX",
		"CAN0_RX", "", "RTC_SQW", "",
		/* GPIO0 C0-C7 */
		"LED2", "SDMMC0_PWR_EN", "USB_OTG_EN_OC#", "LCD0_BKLT_PWM",
		"LCD1_BKLT_PWM", "GMAC0_PHY_RESET#", "TEST5", "",
		/* GPIO0 D0-D7 */
		"UART2_RX", "UART2_TX", "", "",
		"", "", "", "";
};

&gpio1 {
	gpio-line-names =
		/* GPIO1 A0-A7 */
		"I2C3_SDA", "I2C3_SCL", "GPIO0/CAM0_PWR#", "LCD0_BKLT_EN",
		"UART4_RX", "UART4_RSTn", "UART4_TX", "UART4_CTSn",
		/* GPIO1 B0-B7 */
		"PCIE30_CLK_IC_OE", "PIC20_WAKEn_M2", "GPIO1/CAM1_PWR#", "GPIO3/CAM1_RST#",
		"eMMC_D0", "eMMC_D1", "eMMC_D2", "eMMC_D3",
		/* GPIO1 C0-C7 */
		"eMMC_D4", "eMMC_D5", "eMMC_D6", "eMMC_D7",
		"eMMC_CMD", "eMMC_CLK", "eMMC_DS", "eMMC_RESET#",
		/* GPIO1 D0-D7 */
		"", "", "", "",
		"", "SDMMC_D0", "SDMMC_D1", "SDMMC0_D2";
};

&gpio2 {
	gpio-line-names =
		/* GPIO2 A0-A7 */
		"SDMMC0_D3", "SDMMC0_CMD", "SDMMC0_CLK", "GMAC0_RXD2",
		"GMAC0_RXD3", "GMAC0_RXCLK", "GMAC0_TXD2", "GMAC0_TXD3",
		/* GPIO2 B0-B7 */
		"GMAC0_TXCLK", "CAN2_RX", "CAN2_TX", "GMAC0_TXD0",
		"GMAC0_TXD1", "GMAC0_TXEN", "GMAC0_RXD0", "GMAC0_RXD1",
		/* GPIO2 C0-C7 */
		"GMAC0_RXDV_CRS", "SPI2_CK", "SPI2_DIN", "SPI2_DO",
		"SPI2_CS0#", "SPI2_CS1#", "PCIE30X2_PERSTn", "",
		/* GPIO2 D0-D7 */
		"PCIE30_CLK_IC_PDN", "GPIO_EXP_INT", "PCIE30X1_CLKREQn_M1", "PCIE30X1_WAKEn_M1",
		"PCIE30X2_CLKREQn_M1", "PCIE30X2_WAKEn_M1", "GPIO4/HDA_RST#", "UART8_TX";
};

&gpio3 {
	gpio-line-names =
		/* GPIO3 A0-A7 */
		"UART8_RX", "PCIE30X1_PERSTn", "TEST10", "TEST12",
		"TEST11", "TEST2", "TEST13", "TEST3",
		/* GPIO3 B0-B7 */
		"TEST8", "TEST9", "TEST14", "TEST4",
		"TEST6", "TEST7", "GPIO2/CAM0_RST#", "GPIO6/TACHIN",
		/* GPIO3 C0-C7 */
		"GPIO5/PWM_OUT", "PCIE20_PERSTn", "UART5_TX", "UART5_RX",
		"LCD1_BKLT_EN", "LCD1_VDD_EN", "I2S1_MCLK", "I2S1_CK",
		/* GPIO3 D0-D7 */
		"I2S1_LRCK", "I2S1_SDOUT", "I2S1_SDIN", "SMB_ALERT#",
		"RESET_OUT#", "eDP0_HPD/DSI0_TE", "GMAC1_TXD2_M1", "GMAC1_TXD3_M1";
};

&gpio4 {
	gpio-line-names =
		/* GPIO4 A0-A7 */
		"GMAC1_TXCLK_M1", "GMAC1_RXD2_M1", "GMAC1_RXD3_M1", "GMAC1_RXCLK_M1",
		"GMAC1_TXD0_M1", "GMAC1_TXD1_M1", "GMAC1_TXEN_M1", "GMAC1_RXD0_M1",
		/* GPIO4 B0-B7 */
		"GMAC1_RXD1_M1", "GMAC1_RXDV_CRS_M1", "I2C4_SDA", "I2C4_SCL",
		"I2C2_SDA", "I2C2_SCL", "MDC", "MDIO",
		/* GPIO4 C0-C7 */
		"CAM_MCK", "GPIO7", "SPI3_CK", "SPI3_DO",
		"RTC_IRQ#", "SPI3_DIN", "SPI3_CS0#", "HDMI_I2C_SCL",
		/* GPIO4 D0-D7 */
		"HDMI_I2C_SDA", "SPI3_CS1#", "SDMMC0_WP", "",
		"", "", "", "";
};

&gpu {
	status = "okay";
};

&hdmi {
	/* HDMI */
	pinctrl-0 = <&hdmitx_scl &hdmitx_sda>;
};

&mdio0 {
	status = "disabled";
};

&mdio1 {
	rgmii_phy0: phy@2 {
		/* RTL8211F */
		pinctrl-names = "default";
		pinctrl-0 = <&gmac0_rst_pins>;
		compatible = "ethernet-phy-id001c.c916";
		reg = <0x2>;
		reset-assert-us = <20000>;
		reset-deassert-us = <100000>;
		reset-gpios = <&gpio0 RK_PC5 GPIO_ACTIVE_LOW>;
	};

	rgmii_phy1: phy@4 {
		/* RTL8211F */
		pinctrl-names = "default";
		pinctrl-0 = <&gmac1_rst_pins>;
		compatible = "ethernet-phy-id001c.c916";
		reg = <0x4>;
		reset-assert-us = <20000>;
		reset-deassert-us = <100000>;
		reset-gpios = <&gpio0 RK_PA0 GPIO_ACTIVE_LOW>;
	};
};

&pcie2x1 {
	/* PCIE_C */
	pinctrl-names = "default";
	pinctrl-0 = <&pcie2x1_pins>;
	reset-gpios = <&gpio3 RK_PC1 GPIO_ACTIVE_HIGH>;
	vpcie3v3-supply = <&vcc3v3_sys>;
};

&pcie30phy {
	phy-supply = <&vcc3v3_pcie30_clk_run>;
};

&pcie3x1 {
	/* PCIE_B */
	pinctrl-names = "default";
	pinctrl-0 = <&pcie30x1_pins>;
	reset-gpios = <&gpio3 RK_PA1 GPIO_ACTIVE_HIGH>;
	vpcie3v3-supply = <&vcc3v3_pcie30_clk_run>;
};

&pcie3x2 {
	/* PCIE_A */
	pinctrl-names = "default";
	pinctrl-0 = <&pcie30x2_pins>;
	reset-gpios = <&gpio2 RK_PC6 GPIO_ACTIVE_HIGH>;
	vpcie3v3-supply = <&vcc3v3_pcie30_clk_run>;
};

&pwm4 {
	/* LCD0_BKLT_PWM */
};

&pwm5 {
	/* LCD1_BKLT_PWM */
};

&rga {
	status = "okay";
};

&sata0 {
	/* SATA */
	status = "okay";
};

&sdmmc0 {
	/* SDIO */
	pinctrl-names = "default";
	pinctrl-0 = <
		&sdmmc0_bus4 &sdmmc0_clk &sdmmc0_cmd
		&sdmmc0_det &sdmmc0_wp
	>;
	bus-width = <4>;
	cap-mmc-highspeed;
	cap-sd-highspeed;
	cd-gpios = <&gpio0 RK_PA4 GPIO_ACTIVE_LOW>;
	wp-gpios = <&gpio4 RK_PD2 GPIO_ACTIVE_HIGH>;
	sd-uhs-sdr104;
	vmmc-supply = <&vcc_sdmmc0>;
	vqmmc-supply = <&vccio_sd>;
};

&spi2 {
	/* SMARC SPI0 */
	num-cs = <2>;
};

&spi3 {
	/* SMARC SPI1 */
	pinctrl-0 = <&spi3m1_cs0 &spi3m1_cs1 &spi3m1_pins>;
	num-cs = <2>;
};

&uart2 {
	/* SMARC SER1 */
};

&uart4 {
	/* SMARC SER0 */
	pinctrl-0 = <&uart4m0_xfer &uart4m0_ctsn &uart4m0_rtsn>;
};

&uart5 {
	/* SMARC SER3 */
	pinctrl-0 = <&uart5m1_xfer>;
};

&uart8 {
	/* SMARC SER2 */
	pinctrl-0 = <&uart8m1_xfer>;
};

&usb_host0_xhci {
	/* USB0 */
	phys = <&usb2phy0_otg>;
	phy-names = "usb2-phy";
	maximum-speed = "high-speed";
	dr_mode = "host";
	vbus-supply = <&vcc_usb_host0>;
};

&usb_host1_ehci {
	status = "okay";
};

&usb_host1_ohci {
	status = "okay";
};

&usb_host1_xhci {
	status = "okay";
};

&usb2phy0_host {
	status = "okay";
};

&usb2phy1_host {
	status = "okay";
};

&vpu {
	status = "okay";
};

&vdpu_mmu {
	status = "okay";
};

&vepu {
	status = "okay";
};

&vepu_mmu {
	status = "okay";
};

&pinctrl {
	pinctrl-names = "default";
	pinctrl-0 = <&gmac1m1_miim &rst_pins>;

	exp {
		exp_pins: exp-pins {
			rockchip,pins =
				<2 RK_PD1 RK_FUNC_GPIO &pcfg_pull_none>;	/* GPIO_EXP_INT */
		};
	};

	mmc {

		sdmmc0_vcc_pins: sdmmc0-vcc--pins {
			rockchip,pins =
				<0 RK_PC1 RK_FUNC_GPIO &pcfg_pull_none>;	/* SDMMC0_PWR_EN */
		};

		sdmmc0_wp: sdmmc0-wp-pins {
			rockchip,pins =
				<4 RK_PD2 RK_FUNC_GPIO &pcfg_pull_up>;		/* SDMMC0_WP */
		};
	};

	net {
		gmac0_rst_pins: gmac0-rst-pins {
			rockchip,pins =
				<0 RK_PC5 RK_FUNC_GPIO &pcfg_pull_none>;	/* GMAC0_RST */
		};

		gmac1_rst_pins: gmac1-rst-pins {
			rockchip,pins =
				<0 RK_PA0 RK_FUNC_GPIO &pcfg_pull_none>;	/* GMAC1_RST */
		};
	};

	pci {
		pcie2x1_pins: pcie2x1-pins {
			rockchip,pins =
				<3 RK_PC1 RK_FUNC_GPIO &pcfg_pull_none>,	/* pcie20_perstnm1# */
				<1 RK_PB1 4 &pcfg_pull_none>;			/* pcie20_wakenm2 */
		};

		pcie30x1_pins: pcie30x1-pins {
			rockchip,pins =
				<2 RK_PD2 4 &pcfg_pull_none>,			/* pcie30x1_clkreqnm1 */
				<3 RK_PA1 RK_FUNC_GPIO &pcfg_pull_up>,		/* pcie30x1_perstnm1 */
				<2 RK_PD3 4 &pcfg_pull_none>;			/* pcie30x1_wakenm1 */
		};

		pcie30x2_pins: pcie30x2-pins {
			rockchip,pins =
				<2 RK_PD4 4 &pcfg_pull_none>,			/* pcie30x2_clkreqnm1 */
				<2 RK_PC6 RK_FUNC_GPIO &pcfg_pull_up>,		/* PCIE30X2_PERSTN */
				<2 RK_PD5 4 &pcfg_pull_none>;			/* pcie30x2_wakenm1 */
		};

		pcie30_clk_oe_pins: pcie30-clk-oe-pins {
			rockchip,pins =
				<1 RK_PB0 RK_FUNC_GPIO &pcfg_pull_none>;	/* PCIE30_CLK_IC_OE */
		};

		pcie30_clk_run_pins: pcie30-clk-run-pins {
			rockchip,pins =
				<2 RK_PD0 RK_FUNC_GPIO &pcfg_pull_none>;	/* PCIE30_CLK_IC_PDN */
		};
	};

	pps {
		pps_pins: pps-pins {
			rockchip,pins =
				<0 RK_PB6 RK_FUNC_GPIO &pcfg_pull_none>;	/* RTC_SQW */
		};
	};

	rst {
		rst_pins: rst-pins {
			rockchip,pins =
				<3 RK_PD4 RK_FUNC_GPIO &pcfg_output_high>;	/* RESET_OUT */
		};
	};

	rtc {
		rtc_pins: rtc-pins {
			rockchip,pins =
				<4 RK_PC4 RK_FUNC_GPIO &pcfg_pull_none>;	/* RTC_IRQ */
		};
	};

	usb {
		usb_host0_vcc_pins: usb-host0-vcc-pins {
			rockchip,pins =
				<0 RK_PC2 RK_FUNC_GPIO &pcfg_pull_none>;	/* USB_OTG_EN_OC# */
		};
	};
};
